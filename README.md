# engine-cloud-api

## Overview

Welcome to the Engine Cloud API Alpha! As seen in RDC this year, we are introducing new Cloud APIs to allow you to read and make changes to your live Team Create place. Although this alpha has limited functionality, we are currently working towards expanding what properties you can interact with and what functionality is available. Keep in mind, this is still just an early preview so any feedback you give us will help shape the future of the product.


## Functionality

This version of the product is asynchronous. What this means to you is that any request will take a minimum of two API calls. One for the operation request and one for the operation results. Also, please take note that this version is focused on the Source property of the Script, LocalScript, and ModuleScript instance types.

Operation Request:



* Get Instance - Gets data about a specific instance in a place
* List Children - Lists all children of a specific instance
* Update Instance - Sets the values of provided properties

Operation Results:



* Get Operation - Gets the current status of the operation

Another new concept you will need to familiarize yourself with is that of instanceId. InstanceId is a unique identifier of a single instance in a place. 


## Details


### GetInstance



* URL: https://apis.roblox.com/cloud/v2/universes/{universeId}/places/{placeId}/instances/{instanceId}
* REST Method: GET
* Limitations
    * Detailed property for returned information is limited to (Script/LocalScript/ModuleScript).Source
* Parameters
    * UniverseId
        * The UniverseId where the place exists
    * PlaceId
        * The PlaceId where the instance exists
    * InstanceId
        * The UniqueId of the instance
        * NOTE: **root **is an alias for the datamodel root
* Headers
    * x-api-key
        * API key generated by a user with access to the specific UniverseId/PlaceId/InstanceId 


#### Examples

##### Curl
```
curl --include --location --request GET "https://apis.roblox.com/cloud/v2/universes/<universeId>/places/<placeId>/instances/<instanceId>" --header "x-api-key: <api-key>"
```
##### Python Example
```
import requests

# fill out by developer
apiKey = ""
universeId = ""
placeId = ""
instanceId = ""

# immutable constants
apiKeyHeaderKey = "x-api-key"
getInstanceUrl = "https://apis.roblox.com/cloud/v2/universes/%s/places/%s/instances/%s"

def GetInstance():
	url = getInstanceUrl % (universeId, placeId, instanceId)
	headerData = {apiKeyHeaderKey: apiKey}
	return requests.get(url, headers = headerData)

response = GetInstance()
print("Response:", response.status_code, response.text)
```

##### Response
```
{"path":"universes/\<universeId>/places/\<placeId>/instances/\<instanceId>/operations/\<operationId>","done":false}
```

### ListChildren

* URL: https://apis.roblox.com/cloud/v2/universes/{universeId}/places/{placeId}/instances/{instanceId}
* REST Method: GET
* Limitations
    * Detailed property for returned information is limited to (Script/LocalScript/ModuleScript).Source
* Parameters
    * UniverseId
        * The UniverseId where the place exists
    * PlaceId
        * The PlaceId where the instance exists
    * InstanceId
        * The UniqueId of the instance
        * NOTE: **root **is an alias for the datamodel root
* Headers
    * x-api-key
        * API key generated by a user with access to the specific UniverseId/PlaceId/InstanceId 


#### Examples

##### Curl

```
curl --include --location --request GET "https://apis.roblox.com/cloud/v2/universes/<universeId>/places/<placeId>/instances/<instanceId>:listChildren" --header "x-api-key: <api-key>"
```

##### Python
```
import requests

# fill out by developer
apiKey = ""
universeId = ""
placeId = ""
instanceId = ""

# immutable constants
apiKeyHeaderKey = "x-api-key"
getInstanceUrl = "https://apis.roblox.com/cloud/v2/universes/%s/places/%s/instances/%s:listChildren"

def GetInstance():
	url = getInstanceUrl % (universeId, placeId, instanceId)
	headerData = {apiKeyHeaderKey: apiKey}
	results = requests.get(url, headers = headerData)
	return results

results = GetInstance()
print("Operation Results:", results.status_code, results.text)
```

##### Response
```
{"path":"universes/\<universeId>/places/\<placeId>/instances/\<instanceId>/operations/\<operationId>","done":false}
```

### UpdateInstance



* URL: https://apis.roblox.com/cloud/v2/universes/{universeId}/places/{placeId}/instances/{instanceId}
* REST Method: PATCH
* Limitations
    * The only properties that can be updated in this version is (Script/LocalScript/ModuleScript).Source
    * Cannot update instances in packages
    * Cannot update properties that are currently being editing
        * Script.CurrentEditor is not null
        * CollaborativeEditingEnabled is true
        * LiveScriptingSession exists
    * Detailed property for returned information is limited to (Script/LocalScript/ModuleScript).Source
* Headers
    * x-api-key
        * API key generated by a user with access to the specific UniverseId/PlaceId/InstanceId 
    * Content-type
        * The API current accepts ‘application/json’
* Note
    * All JSON table keys should use camelCase


#### Examples

##### Curl
```
curl --include --location --request PATCH "https://apis.roblox.com/cloud/v2/universes/<universeId>/places/<placeId>/instances/<instanceId>" --header "x-api-key: <api key>" --header "Content-Type: application/json" --data '{"engineInstance": {"details": {"<instanceType>": {"<propertyName>": "<propertyValue>"}}}}'
```

##### Python 
```
import json
import requests

# fill out by developer
apiKey = ""
universeId = ""
placeId = ""
instanceId = ""
instanceType = ""
propertyName = ""
propertyValue = ""

# immutable constants
apiKeyHeaderKey = "x-api-key"
contentTypeHeaderKey = "Content-type"
contentTypeHeaderValue = "application/json"
updateInstanceUrl = "https://apis.roblox.com/cloud/v2/universes/%s/places/%s/instances/%s"
detailsJSONKey = "details"
engineInstanceJSONKey = "engine_instance"

def GeneratePostData():
	propertiesDict = {propertyName: propertyValue}
	detailsDict = {instanceType: propertiesDict}
	instanceDict = {detailsJSONKey: detailsDict}
	outerDict = {engineInstanceJSONKey: instanceDict}
	return json.dumps(outerDict)

def UpdateInstance(postData):
    url = updateInstanceUrl % (universeId, placeId, instanceId)
    headerData = {apiKeyHeaderKey: apiKey,
    contentTypeHeaderKey: contentTypeHeaderValue}
    return requests.patch(url, headers = headerData, data = postData)

postData = GeneratePostData()
response = UpdateInstance(postData)
print("Response:", response.status_code, response.text)</code>
```
##### Response
```
{"path":"universes/\<universeId>/places/\<placeId>/instances/\<instanceId>/operations/\<operationId>","done":false}
```
### GetOperation




* URL: https://apis.roblox.com/cloud/v2/universes/{universeId}/places/{placeId}/instances/{instanceId}
* REST Method: GET


#### Examples

##### Curl
```
curl --include --location --request GET "https://apis.roblox.com/cloud/v2/universes/<universeId>/places/<placeId>/instances/<instanceId>/operations/<operationId>" --header "x-api-key:<api key>"
```
##### Python
```
import requests
import time

# fill out by developer
apiKey = ""
operationPath = ""

# mutable constants
numberOfRetries = 10
retryPollingCadence = 5

# immutable constants
apiKeyHeaderKey = "x-api-key"
getOperationUrl = "https://apis.roblox.com/cloud/v2/%s"
doneJSONKey = "done"
engineInstanceJSONKey = "engine_instance"

def GetOperation(operationPath):
	url = getOperationUrl % (operationPath)
	headerData = {apiKeyHeaderKey: apiKey}
	results = requests.get(url, headers = headerData)
	return results

def PollForResults(operationPath):
	currentRetries = 0
	while (currentRetries < numberOfRetries):
		time.sleep(retryPollingCadence)
		results = GetOperation(operationPath)
		currentRetries += 1
	
		if (results.status_code != 200 or results.json()[doneJSONKey]):
			return results

response = PollForResults(operationPath)
print("Response:", response.status_code, response.text)
```

##### Response
```
{'@type': 'type.googleapis.com/roblox.open_cloud.cloud.v2.Instance', 'path': 'universes/<universeId>/places/<placeId>/instances/<instanceId>', 'hasChildren': False, 'engineInstance': {'id': '<instanceId>', 'parent': '<parentInstanceId>', 'name': '<instanceName>', 'details': {'<instanceType>': {'<propertyType>': '<propertyValue'}}}}
```
## Instance Open Cloud Resource Format

The following shows the format for an Open Cloud Instance Resource. This resource is used to communicate that state of instances in the datamodel, with additional metadata for ease of use.
```
{
    '@type': 'type.googleapis.com/roblox.open_cloud.cloud.v2.Instance',
    'path': 'universes/<universeId>/places/<placeId>/instances/<instanceId>',
    'hasChildren': False, 
    'engineInstance': {
        'id': '<instanceId>',
        'parent': '<parentInstanceId>',
        'name': '<instanceName>',
        'details': {
            '<instanceType>': {
                '<propertyType>': '<propertyValue>'
            }
        }
    }
}
```
